<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>控制台</title>
    <link rel="stylesheet" type="text/css" href="./control.css">
    <script>
        // 現有的 JavaScript 函數...

        async function postUser() {
            const username = document.getElementById('username').value;

            const response = await fetch('/control/api/users', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ username })
            });

            if (response.ok) {
                alert('使用者已成功添加！');
                fetchUsers(); // 添加後重新載入使用者列表
                document.getElementById('username').value = '';
            } else {
                const { error } = await response.json();
                alert(`添加使用者時發生錯誤: ${error}`);
            }
        }

        async function fetchUsers() {
            const response = await fetch('/control/api/users');
            const users = await response.json();
            const usersList = document.getElementById('users-list');
            usersList.innerHTML = ''; // 清空現有使用者

            users.forEach(user => {
                const listItem = document.createElement('li');
                listItem.innerHTML = `<strong>${user.username}</strong>`;
                
                // 創建刪除按鈕
                const deleteButton = document.createElement('button');
                deleteButton.textContent = '刪除';
                deleteButton.className = 'delete-button';
                deleteButton.onclick = () => deleteUser(user._id);
                listItem.appendChild(deleteButton);
                
                usersList.appendChild(listItem);
            });
        }

        async function deleteUser(id) {
            const response = await fetch(`/control/api/users/${id}`, {
                method: 'DELETE'
            });

            if (response.ok) {
                alert('使用者已成功刪除！');
                fetchUsers(); // 刪除後重新載入使用者列表
            } else {
                const { error } = await response.json();
                alert(`刪除使用者時發生錯誤: ${error}`);
            }
        }

        async function postCheckIn() {
            const userId = document.getElementById('checkin-user').value;
            const response = await fetch('/control/api/checkins', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ userId })
            });

            if (response.ok) {
                alert('打卡成功！');
            } else {
                const { error } = await response.json();
                alert(`打卡時發生錯誤: ${error}`);
            }
        }

        window.onload = function() {
            fetchAnnouncements();
            fetchUsers(); // 在頁面加載時獲取使用者
        };
    </script>
</head>
<body>
    <div class="container">
        <h1>控制台</h1>
        
        <h2>發佈公告</h2>
        <input type="text" id="title" placeholder="公告標題" required>
        <textarea id="content" placeholder="公告內容" required></textarea>
        <button onclick="postAnnouncement()">發佈公告</button>

        <h2>現有公告</h2>
        <ul id="announcements-list"></ul>
        
        <h2>管理使用者</h2>
        <input type="text" id="username" placeholder="使用者名稱" required>
        <button onclick="postUser()">添加使用者</button>
        <ul id="users-list"></ul>

        <h2>打卡</h2>
        <select id="checkin-user">
            <!-- 此處應填充使用者下拉選單 -->
        </select>
        <button onclick="postCheckIn()">打卡</button>

        <button onclick="goBack()">返回</button>
    </div>
</body>
</html>
